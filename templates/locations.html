<!DOCTYPE html>
<html>
<head>
    <title>Localizaciones</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="static/assets/iconn.svg" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link rel="stylesheet" href="{{url_for('static',filename='css/main.css')}}"/>

    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="{{ url_for('static', filename='js/scripts.js')}}"></script>
    <!--Tabulator-->
    <link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>

    <!--Manejo de las horas con Luxon-->
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.28.0/build/global/luxon.min.js"></script>
</head>
<body>
    <div class="table-responsive">
        <div id="tabla">
        </div>
    </div>
</body>
</html>
<script>
    lista = {{data |tojson}}
    console.log(lista)

    var tableColumns = [
        {title: "Fecha publicación", field: "datetime",hozAlign:"center", formatter: "datetime",headerFilter: "input", formatterParams:{
            inputFormat:"yyyy-MM-dd HH:mm:ss+00:00",
            outputFormat:"dd/MM/yyyy",
            invalidPlaceholder:"Fecha invalida",
            timezone:"Europe/Madrid",
        }},
        {title: "URL Tweet", field: "url", formatter: "link", formatterParams: {labelField: "url", target: "_blank"}},
        
    ];
    
    var tableData = [];
    for (var i = 0; i < lista.length; i++) {
        var item = lista[i];
        for (var j = 0; j < item.datetime.length; j++) {
            console.log(item.datetime[j])
            tableData.push({
                location: item.location,
                datetime: item.datetime[j],
                maps: item.maps,
                url: item.url[j],
            });
        }
    }
    var table = new Tabulator("#tabla", {
        responsiveLayout:true,
        data: tableData,
        layout: "fitDataTable",
        columns: tableColumns,
        groupBy: function(data){
            //data - the data object for the row being grouped
            return data.location; //groups by location
        },
        groupHeader:function(value, count, data, group){
            //value - the value all members of this group share
            //count - the number of rows in this group
            //data - an array of all the row data objects in this group
            //group - the group component for the group
            console.log(data)
            console.log("hla")
            console.log(data[0].maps)
        
            return value  + " - " + "<a href='" + data[0].maps +"'target='_blank'>Link localización</a>" +"<span style='color:#d00; margin-left:10px;'>(" + count + " item)</span>";
        },
    });
    // ajustar tabla al tamaño del contenedor
    window.addEventListener("resize", function(){
    table.redraw();
});
</script>
